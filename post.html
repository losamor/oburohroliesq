<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Albert+Sans:ital,wght@0,100..900;1,100..900&family=Black+Han+Sans&family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&family=Instrument+Sans:ital,wght@0,400..700;1,400..700&family=Martel+Sans:wght@200;300;400;600;700;800;900&family=Mona+Sans:ital,wght@0,200..900;1,200..900&family=Pixelify+Sans:wght@400..700&family=Questrial&family=Racing+Sans+One&family=Smooch+Sans:wght@100..900&family=Vina+Sans&display=swap" rel="stylesheet">
    <title>Blog Post | Oburoh Roli ESQ</title>
    <style>
        body {
            background-color: #FFD4E3;
            font-family: "DM Sans", sans-serif;
            margin: 0;
            padding: 0;
        }

        .post-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 60px 40px;
            background-color: #FFC5D9;
            min-height: 100vh;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: black;
            text-decoration: none;
            font-size: 16px;
            margin-bottom: 32px;
            transition: opacity 0.3s ease;
        }

        .back-link:hover {
            opacity: 0.7;
        }

        .post-header {
            margin-bottom: 32px;
        }

        .post-title {
            font-family: 'Questrial', sans-serif;
            font-size: 48px;
            line-height: 1.2;
            margin: 0 0 16px 0;
        }

        .post-meta {
            display: flex;
            gap: 24px;
            color: #666;
            font-size: 16px;
            align-items: center;
        }

        .post-meta-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .post-image {
            width: 100%;
            height: 400px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 32px;
        }

        .post-content {
            font-size: 18px;
            line-height: 1.8;
            color: #333;
        }

        .post-content p {
            margin-bottom: 24px;
        }

        .post-content h2 {
            font-family: 'Questrial', sans-serif;
            font-size: 32px;
            margin: 40px 0 16px 0;
        }

        .post-content h3 {
            font-family: 'Questrial', sans-serif;
            font-size: 24px;
            margin: 32px 0 12px 0;
        }

        .post-engagement {
            margin-top: 48px;
            padding-top: 32px;
            border-top: 1px solid #eee;
            display: flex;
            gap: 16px;
            align-items: center;
        }

        .like-button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: white;
            border: 2px solid #ddd;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            font-family: "DM Sans", sans-serif;
        }

        .like-button:hover {
            border-color: #ff6b6b;
            background: #fff5f5;
        }

        .like-button.liked {
            background: #ff6b6b;
            border-color: #ff6b6b;
            color: white;
        }

        .like-button:active {
            transform: scale(0.95);
        }

        .like-icon {
            font-size: 20px;
        }

        .loading {
            text-align: center;
            padding: 100px 20px;
            color: #666;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .post-container {
                padding: 40px 20px;
            }

            .post-title {
                font-size: 32px;
            }

            .post-meta {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .post-image {
                height: 250px;
            }
        }
    </style>
    <!-- Netlify Identity Widget -->
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
</head>
<body>
    <header>
        <nav style="display: flex; justify-content: space-between; align-items: center; padding: 22px 100px; box-shadow: 0 0.5px 0 0 rgba(0, 0, 0, 0.8);">
            <a href="index.html" style="font-size: 20px; font-family: 'Questrial', sans-serif;">oburohroli</a>
            <ul style="display: flex; list-style: none; gap: 4rem; padding: 0; margin: 0; font-size: 20px;">
                <li><a href="#about-me">About Me</a></li>
                <li><a href="blog.html">Blog</a></li>
                <li><a href="#contact">Contact</a></li>
            </ul>
        </nav>
    </header>

    <div class="post-container" id="post-container">
        <div class="loading">Loading post...</div>
    </div>

    <section class="contact" id="contact" style="display: flex; flex-direction: column; padding: 48px 100px 16px 100px; background-color: #FFEDED; gap: 48px;">
            <div style="padding: 0; margin: 0;">
                <h2 style="font-family: Questrial, sans-serif; font-size: 40px; text-align: center;">Contact Me</h2>
            </div>
            <div>
                <p style="text-align: center; font-size: 20px; line-height: 28px;">
                    Want to keep in touch with me? You can follow me on my social platforms or reach out directly. Whether you have questions about my work, want to discuss potential collaborations, or just want to say hello, feel free to connect with me.
                </p>
            </div>
            <div>
                <ul style="display: flex; justify-content: center; gap: 24px; list-style: none; padding: 0; margin: 0; gap: 72px;">
                    <li><a href="https://www.facebook.com/oburoh.roli" target="_blank">Facebook</a></li>
                    <li><a href="https://www.twitter.com/oburoh_roli" target="_blank">Twitter</a></li>
                    <li><a href="https://www.linkedin.com/in/oburoh-roli" target="_blank">LinkedIn</a></li>
                    <li><a href="mailto:oburoh.roli@gmail.com">Email</a></li>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <p style="font-size: 16px;">¬© 2026 Oburoh Roli ESQ. All rights reserved.</p>
                <ul style="display: flex; list-style: none; gap: 4rem; padding: 0; margin: 0; font-size: 16px;">
                <li><a href="#about-me">About Me</a></li>
                <li><a href="blog.html">Blog</a></li>
                <li><a href="#contact">Contact</a></li>
            </ul>
            </div>
    </section>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, get, runTransaction } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyC31uvs3fMjDEPLL6xyiyVnJHuU9ZPHYuU",
            authDomain: "blog-sampl3.firebaseapp.com",
            databaseURL: "https://blog-sample-b13e4-default-rtdb.firebaseio.com",
            projectId: "blog-sampl3",
            storageBucket: "blog-sampl3.firebasestorage.app",
            messagingSenderId: "80128412606",
            appId: "1:80128412606:web:6b23f78724ffabc0c507ef",
            measurementId: "G-5Y13R7W5DH"
        };

        // Initialize Firebase
        let firebaseInitialized = false;
        let database = null;
        
        try {
            const app = initializeApp(firebaseConfig);
            database = getDatabase(app);
            firebaseInitialized = true;
            console.log('Firebase initialized successfully');
        } catch (error) {
            console.error('Firebase initialization error:', error);
        }

        // Get view count
        async function getViewCount(postSlug) {
            if (!firebaseInitialized) return 0;
            
            const viewRef = ref(database, 'views/' + postSlug);
            try {
                const snapshot = await get(viewRef);
                return snapshot.val() || 0;
            } catch (error) {
                console.error('Error getting view count:', error);
                return 0;
            }
        }

        // Increment view count
        async function incrementViewCount(postSlug) {
            if (!firebaseInitialized) return;
            
            const viewRef = ref(database, 'views/' + postSlug);
            try {
                await runTransaction(viewRef, (currentValue) => {
                    return (currentValue || 0) + 1;
                });
            } catch (error) {
                console.error('Error incrementing view count:', error);
            }
        }

        // Get like count
        async function getLikeCount(postSlug) {
            if (!firebaseInitialized) return 0;
            
            const likeRef = ref(database, 'likes/' + postSlug);
            try {
                const snapshot = await get(likeRef);
                return snapshot.val() || 0;
            } catch (error) {
                console.error('Error getting like count:', error);
                return 0;
            }
        }

        // Toggle like
        async function toggleLike(postSlug) {
            if (!firebaseInitialized) return;
            
            const likeRef = ref(database, 'likes/' + postSlug);
            const userLikedKey = 'liked_' + postSlug;
            const hasLiked = localStorage.getItem(userLikedKey) === 'true';
            
            try {
                await runTransaction(likeRef, (currentValue) => {
                    if (hasLiked) {
                        return Math.max(0, (currentValue || 0) - 1);
                    } else {
                        return (currentValue || 0) + 1;
                    }
                });
                
                localStorage.setItem(userLikedKey, !hasLiked);
                return !hasLiked;
            } catch (error) {
                console.error('Error toggling like:', error);
                return hasLiked;
            }
        }

        // Check if user has liked
        function hasUserLiked(postSlug) {
            return localStorage.getItem('liked_' + postSlug) === 'true';
        }

        // Parse front matter from markdown
        function parseFrontMatter(content) {
            const frontMatterMatch = content.match(/^---\n([\s\S]*?)\n---/);
            if (!frontMatterMatch) return null;
            
            const frontMatter = {};
            frontMatterMatch[1].split('\n').forEach(line => {
                const [key, ...valueParts] = line.split(':');
                if (key && valueParts.length) {
                    frontMatter[key.trim()] = valueParts.join(':').trim().replace(/^["']|["']$/g, '');
                }
            });
            
            const body = content.replace(/^---\n[\s\S]*?\n---\n/, '');
            
            return { data: frontMatter, content: body };
        }

        // Simple markdown to HTML converter
        function markdownToHtml(markdown) {
            let html = markdown;
            
            // Headers
            html = html.replace(/^### (.*$)/gim, '<h3>$1</h3>');
            html = html.replace(/^## (.*$)/gim, '<h2>$1</h2>');
            html = html.replace(/^# (.*$)/gim, '<h1>$1</h1>');
            
            // Bold
            html = html.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            
            // Italic
            html = html.replace(/\*(.*?)\*/g, '<em>$1</em>');
            
            // Links
            html = html.replace(/\[([^\]]+)\]\(([^\)]+)\)/g, '<a href="$2">$1</a>');
            
            // Paragraphs
            html = html.split('\n\n').map(para => `<p>${para.replace(/\n/g, '<br>')}</p>`).join('');
            
            return html;
        }

        // Get post slug from URL
        function getPostSlugFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('slug');
        }

        // Handle like button click
        async function handleLikeClick(postSlug, button) {
            button.disabled = true;
            
            const newLikedState = await toggleLike(postSlug);
            const newLikeCount = await getLikeCount(postSlug);
            
            // Update button appearance
            if (newLikedState) {
                button.classList.add('liked');
                button.querySelector('.like-icon').textContent = '‚ù§Ô∏è';
            } else {
                button.classList.remove('liked');
                button.querySelector('.like-icon').textContent = 'ü§ç';
            }
            
            button.querySelector('.like-count').textContent = newLikeCount;
            button.disabled = false;
        }

        // Load and display post
        async function loadPost() {
            const postSlug = getPostSlugFromUrl();
            
            if (!postSlug) {
                document.getElementById('post-container').innerHTML = 
                    '<p style="text-align: center;">Post not found. <a href="blog.html">Back to blog</a></p>';
                return;
            }

            try {
                const response = await fetch('https://api.github.com/repos/losamor/blogsample/contents/posts');
                
                if (!response.ok) {
                    throw new Error('Unable to fetch posts');
                }
                
                const files = await response.json();
                const postFile = files.find(file => file.name === postSlug + '.md');
                
                if (!postFile) {
                    document.getElementById('post-container').innerHTML = 
                        '<p style="text-align: center;">Post not found. <a href="blog.html">Back to blog</a></p>';
                    return;
                }
                
                const contentResponse = await fetch(postFile.download_url);
                const content = await contentResponse.text();
                const parsed = parseFrontMatter(content);
                
                if (!parsed) {
                    throw new Error('Invalid post format');
                }
                
                // Increment view count
                await incrementViewCount(postSlug);
                
                // Get counts
                const viewCount = await getViewCount(postSlug);
                const likeCount = await getLikeCount(postSlug);
                const userLiked = hasUserLiked(postSlug);
                
                const post = {
                    title: parsed.data.title || 'Untitled',
                    date: parsed.data.date || new Date().toISOString(),
                    image: parsed.data.image || 'images/iklas-WpFZu1CGBNc-unsplash.jpg',
                    body: parsed.content
                };
                
                const dateObj = new Date(post.date);
                const formattedDate = dateObj.toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
                
                const likeIcon = userLiked ? '‚ù§Ô∏è' : 'ü§ç';
                const likedClass = userLiked ? 'liked' : '';
                
                const container = document.getElementById('post-container');
                container.innerHTML = `
                    <a href="blog.html" class="back-link">
                        <span class="material-symbols-outlined">arrow_back</span>
                        Back to Blog
                    </a>
                    
                    <article>
                        <div class="post-header">
                            <h1 class="post-title">${post.title}</h1>
                            <div class="post-meta">
                                <div class="post-meta-item">
                                    <span class="material-symbols-outlined">calendar_today</span>
                                    ${formattedDate}
                                </div>
                                <div class="post-meta-item">
                                    <span class="material-symbols-outlined">visibility</span>
                                    ${viewCount} views
                                </div>
                            </div>
                        </div>
                        
                        <img src="${post.image}" alt="${post.title}" class="post-image">
                        
                        <div class="post-content">
                            ${markdownToHtml(post.body)}
                        </div>
                        
                        <div class="post-engagement">
                            <button class="like-button ${likedClass}" onclick="handleLikeClick('${postSlug}', this)">
                                <span class="like-icon">${likeIcon}</span>
                                <span class="like-count">${likeCount}</span>
                            </button>
                        </div>
                    </article>
                `;
                
                // Make handleLikeClick available globally
                window.handleLikeClick = handleLikeClick;
                
            } catch (error) {
                console.error('Error loading post:', error);
                document.getElementById('post-container').innerHTML = 
                    `<p style="text-align: center;">Error loading post: ${error.message}<br><a href="blog.html">Back to blog</a></p>`;
            }
        }

        // Load post when page loads
        setTimeout(loadPost, 1000);

        // Netlify Identity redirect
        if (window.netlifyIdentity) {
            window.netlifyIdentity.on("init", user => {
                if (!user) {
                    window.netlifyIdentity.on("login", () => {
                        document.location.href = "/admin/";
                    });
                }
            });
        }
    </script>
</body>
</html>
